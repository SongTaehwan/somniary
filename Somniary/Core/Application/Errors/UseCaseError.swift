//
//  UseCaseError.swift
//  Somniary
//
//  Created by ì†¡íƒœí™˜ on 12/23/25.
//

import Foundation

/// ìœ ìŠ¤ì¼€ì´ìŠ¤ê°€ ì™¸ë¶€ë¡œ ë…¸ì¶œí•˜ëŠ” ì‹¤íŒ¨ë¥¼ domain(ê³„ì•½), application, unexpected(ê³„ì•½ ë°–/ë¶ˆë³€ì‹)ë¡œ êµ¬ì„±í•´ ë°˜í™˜í•˜ëŠ” ì—ëŸ¬
/// ContractError - í•´ë‹¹ ìœ ìŠ¤ì¼€ì´ìŠ¤ ê³„ì•½ ë‚´ì—ì„œ ì²˜ë¦¬í•  ì—ëŸ¬
/// FailureCause - ContractError ì„ í¬í•¨í•˜ëŠ” ë„ë©”ì¸ ì—ëŸ¬ì˜ ì§‘í•©. ê³„ì•½ ë°– ì—ëŸ¬ë„ í¬í•¨
enum UseCaseError<ContractError: Error & Equatable, BoundaryError: Error & Equatable>: Error, Equatable {
    /// ìœ ìŠ¤ì¼€ì´ìŠ¤ ê³„ì•½/ê·œì¹™
    case contract(ContractError)

    /// ë„ë©”ì¸ ì—ëŸ¬ì¸ë° ì´ ìœ ìŠ¤ì¼€ì´ìŠ¤ ê³„ì•½ ë°–
    /// "ì§€ì›í•˜ì§€ ì•ŠëŠ” ìƒíƒœ/ì •ì±…" ë“±ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ ë…¸ì¶œ
    case outOfContract(BoundaryError)

    /// ì–´í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ ì—ëŸ¬
    /// ì°¸ê³ : ë„ë©”ì¸/ìœ ìŠ¤ì¼€ì´ìŠ¤ íë¦„ì—ì„œì˜ ë¶ˆë³€ì‹/ì •í•©ì„± ìœ„ë°˜ì€
    /// SystemFailure.internalInvariantViolation ë™ì¼í•˜ê²Œ í•¸ë“¤ë§í•˜ë¯€ë¡œ
    /// ì¸í”„ë¼ ê³„ì¸µê³¼ ìœ ìŠ¤ì¼€ì´ìŠ¤ë¥¼ êµ¬ë¶„ì´ í•„ìš”í•  ë•Œ ë¶„ë¦¬í•œë‹¤.
    case system(SystemFailure)

    /// INFO: ì¸í”„ë¼ ê³„ì¸µê³¼ êµ¬ë¶„ì´ í•„ìš”í•  ë•Œ ì•„ë˜ì˜ ì¼€ì´ìŠ¤ ì‚¬ìš©ì„ ê³ ë ¤í•  ê²ƒ.
    /// ë„ë©”ì¸/ìœ ìŠ¤ì¼€ì´ìŠ¤ íë¦„ì—ì„œì˜ ë¶ˆë³€ì‹/ì •í•©ì„± ìœ„ë°˜ (ì‚¬ìš©ìì—ê²Œ ë…¸ì¶œí•´ì•¼ í•¨)
    /// ì£¼ë¡œ ì•± ì½”ë“œ ìˆ˜ì •ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ì—†ëŠ” ì¼€ì´ìŠ¤
    /// ì˜ˆ) ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜, ë°ì´í„° ì •í•©ì„± ì˜¤ë¥˜
    /// "ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤" ë“±ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ ë…¸ì¶œ
//    case invariantViolated(reason: String)
}

extension UseCaseError {
    static func from(
        boundaryError error: BoundaryError,
        classify: (BoundaryError) -> ContractError?
    ) -> Self {
        if let contract = classify(error) {
            // 1. ë„ë©”ì¸ ê³„ì•½ ì•ˆ
            return .contract(contract)
        }

        // 2. ë„ë©”ì¸ ê³„ì•½ ë°–
        // - ë„ë©”ì¸/ìœ ìŠ¤ì¼€ì´ìŠ¤ ë¶ˆë³€ì‹ ìœ„ë°˜ì€ ê³„ì•½ ë°–ê³¼ ë™ì¼í•˜ê²Œ ì²˜ë¦¬í•œë‹¤.
        // INFO: ì‹œìŠ¤í…œì´ ë³µì¡í•´ì§ˆ ë•Œ êµ¬ë¶„í• ì§€ ê³ ë ¤
        return .outOfContract(error)
    }
}

#if DEBUG
extension UseCaseError {
    func debugPrint(caller: String = #function, file: String = #file, line: Int = #line) {
        let time = Date.now.formatted(date: .numeric, time: .standard)
        let fileName = (file as NSString).lastPathComponent

        let message = {
            switch self {
            case .contract(let error):
                return """
                â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                â•‘ ğŸ’¥ \(UseCaseError.self)
                â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                â•‘ ğŸ“š Layer      : Application
                â•‘ ğŸ“ Caller     : \(caller)
                â•‘ ğŸ“ Location   : \(fileName):\(line)
                â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                â•‘ ğŸ¯ Level      : Contract
                â•‘ ğŸ’¬ Case       : \(String.init(describing: error).replacingOccurrences(of: "Somniary.", with: ""))
                â• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                â•‘ â° Time       : \(time)
                â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                """
            case .outOfContract(let error):
                return """
                â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                â•‘ ğŸ’¥ \(UseCaseError.self) Details
                â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                â•‘ ğŸ“š Layer      : Application
                â•‘ ğŸ“ Caller     : \(caller)
                â•‘ ğŸ“ Location   : \(fileName):\(line)
                â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                â•‘ ğŸ¯ Level      : OutOfContract
                â•‘ ğŸ’¬ Case       : \(String.init(describing: error).replacingOccurrences(of: "Somniary.", with: ""))
                â• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                â•‘ â° Time       : \(time))
                â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                """
            case .system(let error):
                return """
                â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                â•‘ ğŸ’¥ \(UseCaseError.self)
                â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                â•‘ ğŸ“š Layer      : Application
                â•‘ ğŸ“ Caller     : \(caller)
                â•‘ ğŸ“ Location   : \(fileName):\(line)
                â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                â•‘ ğŸ¯ Level      : System
                â•‘ ğŸ’¬ Case       : \(String.init(describing: error).replacingOccurrences(of: "Somniary.", with: ""))
                â• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                â•‘ â° Time       : \(time))
                â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                """
            }
        }()

        print(message)
    }
}
#endif
